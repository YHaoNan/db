# 数据库结构
数据库是一个文件夹，里面存储着数据表文件

# 数据表结构
数据表是一个物理文件，它由固定大小的页面组成，默认情况下一个页为16KB

## 页结构
一个页由如下结构组成
```
区域     作用                             大小  
文件头   描述一个页与所在文件的关系           60字节
页头     描述一个页的信息                   60字节
数据区   该页中的数据                       非固定
空闲区   该页中剩余空间大小                  非固定
```

文件头结构如下
```
字段                       作用                   大小
FIL_PAGE_OFFSET           该页在文件中的偏移量      4字节

```

页头结构如下
```
字段                      作用                        大小
PAGE_TYPE                页类型                       1字节
PAGE_TAIL                页尾指针 指向页数据中最后的位置  2字节
```

页类型
```
0x00           表头页
0x01           数据页
```

## 表头页
数据表的第一页就是表头页，其中包含表的一些信息。

表头页的数据区结构如下：
```
TABLE_PAGE_TAIL              该表中最后一个页的偏移量                             4字节
TALBE_PAGE_COLUMNS           暂时未启用，后期准备把表的schema放到表文件中时再启用    不固定
```


## 数据页
数据页是数据库中用来保存数据的页，数据页的数据区结构如下

```
行行行行行行行行行行行行...
```

没错，就是一大堆行的字节码而已

## 行结构
不允许`NULL`值存在，所以行结构很简单

```
行末尾位置             2字节
列列列列列列列列列列列...
```

## 定长列结构
目前只支持`TINYINT`、`SMALLINT`、`INT`

```
TINYINT    1字节
SMALLINT   2字节
INT        4字节
```

## 变长列结构
目前只支持VARCHAR

VARCHAR采用如下形式存储：
```
列长度     2字节
列长度字节的数据
```

变长列结构具有一个用户期望长度和实际长度，在变长结构中这两个值往往不相等。

比如VARCHAR，它前面多了两个字节，并且就算忽略这两个字节，使用多字节编码时，VARCHAR的长度也具有不确定性。